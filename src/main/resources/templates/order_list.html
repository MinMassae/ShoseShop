<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ³¨æ–‡å±¥æ­´</title>
    <style>
        body { font-family: Arial, sans-serif; }
        header { padding: 10px; background-color: #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        #logo { cursor: pointer; }
        nav ul { list-style: none; display: flex; gap: 15px; margin: 0; padding: 0; }
        nav ul li a { text-decoration: none; color: #333; }
        aside { float: left; width: 200px; padding: 10px; }
        main { margin-left: 220px; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 8px; text-align: center; }
    </style>
</head>
<body>

<header>
    <div id="logo" onclick="location.href='/'">ğŸ‘Ÿ ShoseShop</div>
    <nav><ul id="menu"></ul></nav>
</header>

<aside>
    <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
    <ul>
        <li><a href="/mypage">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±</a></li>
        <li><a href="/mypage/cart">ã‚«ãƒ¼ãƒˆãƒªã‚¹ãƒˆ</a></li>
        <li><a href="/mypage/orders">æ³¨æ–‡å±¥æ­´</a></li>
    </ul>
</aside>

<main>
    <h2>ğŸ“ æ³¨æ–‡å±¥æ­´</h2>

    <div id="orderList"></div>
</main>

<script>
    const token = localStorage.getItem("accessToken");

    if (!token) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
        location.href = "/login";
    }

    const menu = document.getElementById("menu");
    if (token) {
        menu.innerHTML = `
      <li><a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
      <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
    `;
    }

    function logout() {
        localStorage.removeItem("accessToken");
        location.href = "/login";
    }

    function loadOrders() {
        fetch("/api/orders", {
            method: "GET",
            headers: { "Authorization": "Bearer " + token }
        })
            .then(res => {
                if (!res.ok) throw new Error("æ³¨æ–‡å±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼");
                return res.json();
            })
            .then(data => {
                const container = document.getElementById("orderList");
                if (data.length === 0) {
                    container.innerHTML = "<p>æ³¨æ–‡å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
                    return;
                }

                data.forEach(order => {
                    const orderDiv = document.createElement("div");
                    orderDiv.style.border = "1px solid #ccc";
                    orderDiv.style.padding = "10px";
                    orderDiv.style.marginBottom = "20px";

                    let html = `
          <h3>æ³¨æ–‡æ—¥: ${order.date}</h3>
          <p><strong>çŠ¶æ…‹:</strong> ${order.status}</p>
          <table style="width:100%; margin-top:10px;">
            <thead>
              <tr>
                <th>å•†å“å</th>
                <th>ã‚µã‚¤ã‚º</th>
                <th>æ•°é‡</th>
                <th>ä¾¡æ ¼</th>
                <th>å°è¨ˆ</th>
              </tr>
            </thead>
            <tbody>
        `;

                    order.items.forEach(item => {
                        html += `
            <tr>
              <td>${item.productName}</td>
              <td>${item.size}</td>
              <td>${item.quantity}</td>
              <td>${item.price}å††</td>
              <td>${item.price * item.quantity}å††</td>
            </tr>
          `;
                    });

                    html += `
            </tbody>
          </table>
        `;

                    orderDiv.innerHTML = html;
                    container.appendChild(orderDiv);
                });
            })
            .catch(error => {
                console.error(error);
                alert("æ³¨æ–‡å±¥æ­´ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            });
    }

    document.addEventListener("DOMContentLoaded", loadOrders);
</script>

</body>
</html>
