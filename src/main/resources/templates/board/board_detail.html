<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>æŠ•ç¨¿è©³ç´°</title>
</head>
<body>

<!-- ğŸ”· í—¤ë” -->
<header>
  <div id="logo" onclick="location.href='/'" style="cursor:pointer;">ğŸ‘Ÿ ShoseShop</div>
  <nav>
    <ul id="menu">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </ul>
  </nav>
</header>

<!-- ğŸ”· ë©”ì¸ -->
<main style="margin-top: 30px;">
  <h2 th:text="${post.title}">ã‚¿ã‚¤ãƒˆãƒ«</h2>

  <p><strong>ä½œæˆæ—¥:</strong> <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">æ—¥ä»˜</span></p>
  <hr>
  <p th:text="${post.content}" style="white-space: pre-wrap;"></p>
  <hr>

  <!-- ğŸ”¹ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ìë§Œ ë…¸ì¶œ) -->
  <div th:if="${isEditable}" style="margin-top: 20px;">
    <button th:onclick="'location.href=\'/board/edit/' + ${post.id} + '\''">ç·¨é›†</button>
    <button onclick="deletePost()">å‰Šé™¤</button>
  </div>

  <button style="margin-top: 20px;" onclick="history.back()">æˆ»ã‚‹</button>
</main>

<script>
  const token = localStorage.getItem("accessToken");
  const menu = document.getElementById("menu");

  if (token) {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
      <li><a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
      <li><a href="/register">ä¼šå“¡ç™»éŒ²</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
    `;
  }

  function logout() {
    localStorage.removeItem("accessToken");
    location.href = "/login";
  }

  function deletePost() {
    if (!confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;

    const postId = /*[[${post.id}]]*/ 0;

    fetch(`/api/board/${postId}`, {
      method: "DELETE",
      headers: {
        "Authorization": "Bearer " + token
      }
    })
            .then(res => {
              if (res.ok) {
                alert("å‰Šé™¤ãŒå®Œäº†ã—ã¾ã—ãŸã€‚");
                location.href = "/board";
              } else {
                return res.text().then(text => { throw new Error(text); });
              }
            })
            .catch(err => {
              console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:", err.message);
              alert("å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            });
  }
</script>

</body>
</html>
