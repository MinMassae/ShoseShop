<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ãŠã—ã‚‰ã› ç·¨é›†</title>
</head>
<body>

<!-- ğŸ”· í—¤ë” -->
<header>
  <div id="logo" onclick="location.href='/'" style="cursor:pointer;">ğŸ‘Ÿ ShoseShop</div>
  <nav>
    <ul id="menu">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </ul>
  </nav>
</header>

<!-- ğŸ”· ë³¸ë¬¸ -->
<main style="margin: 20px;">
  <h2>ãŠã—ã‚‰ã› ç·¨é›†</h2>

  <form id="postForm">
    <!-- ìˆ˜ì • ì‹œ ID ê°’ -->
    <input type="hidden" id="postId" th:value="${post?.id}">

    <div>
      <label for="title">ã‚¿ã‚¤ãƒˆãƒ«:</label><br>
      <input type="text" id="title" th:value="${post?.title}" required style="width: 100%;">
    </div>
    <br>
    <div>
      <label for="content">å†…å®¹:</label><br>
      <textarea id="content" rows="10" required style="width: 100%;">[[${post?.content}]]</textarea>
    </div>
    <br>
    <button type="submit">ä¿å­˜</button>
  </form>
</main>

<!-- ğŸ”· ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const token = localStorage.getItem("accessToken");
  const menu = document.getElementById("menu");

  if (token) {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
      <li><a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
      <li><a href="/register">ä¼šå“¡ç™»éŒ²</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
    `;
  }

  function logout() {
    localStorage.removeItem("accessToken");
    location.href = "/login";
  }

  // âœ… ê³µì§€ ì €ì¥ (ì‘ì„± or ìˆ˜ì •)
  document.getElementById("postForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const id = document.getElementById("postId").value;
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;

    const method = id ? "PUT" : "POST";
    const url = id ? `/api/board/notice/${id}` : "/api/board/notice";

    fetch(url, {
      method: method,
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ title, content })
    })
            .then(res => {
              if (!res.ok) throw new Error("ä¿å­˜å¤±æ•—");
              alert("ä¿å­˜ã—ã¾ã—ãŸã€‚");
              location.href = "/board?type=notice";
            })
            .catch(err => {
              console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", err);
              alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            });
  });
</script>

</body>
</html>
