<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>æŠ•ç¨¿ä½œæˆ</title>
</head>
<body>

<!-- ğŸ”· í—¤ë” -->
<header>
  <div id="logo" onclick="location.href='/'" style="cursor:pointer;">ğŸ‘Ÿ ShoseShop</div>
  <nav>
    <ul id="menu">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </ul>
  </nav>
</header>

<!-- ğŸ”· ë©”ì¸ -->
<main style="margin-top: 30px;">
  <h2 th:text="${type == 'notice' ? 'ãŠã—ã‚‰ã› ä½œæˆ' : 'Q&A ä½œæˆ'}"></h2>

  <form id="postForm">
    <input type="hidden" id="type" th:value="${type}"/>

    <label for="title">ã‚¿ã‚¤ãƒˆãƒ«:</label><br>
    <input type="text" id="title" name="title" required style="width: 400px;"><br><br>

    <label for="content">å†…å®¹:</label><br>
    <textarea id="content" name="content" rows="10" cols="80" required></textarea><br><br>

    <button type="submit">æŠ•ç¨¿ã™ã‚‹</button>
  </form>
</main>

<!-- ğŸ”· ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const token = localStorage.getItem("accessToken");
  const menu = document.getElementById("menu");

  if (token) {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
      <li><a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
    `;
  } else {
    menu.innerHTML = `
      <li><a href="/items">å•†å“ä¸€è¦§</a></li>
      <li><a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
      <li><a href="/register">ä¼šå“¡ç™»éŒ²</a></li>
      <li><a href="/board">æ²ç¤ºæ¿</a></li>
    `;
  }

  function logout() {
    localStorage.removeItem("accessToken");
    location.href = "/login";
  }

  // âœ… í¼ ì œì¶œ ì²˜ë¦¬
  document.getElementById("postForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const type = document.getElementById("type").value;
    const title = document.getElementById("title").value;
    const content = document.getElementById("content").value;

    if (!token) {
      alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
      location.href = "/login";
      return;
    }

    fetch("/api/board/write", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ title, content, type })
    })
            .then(res => {
              if (res.ok) {
                alert("æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸã€‚");
                location.href = `/board?type=${type}`;
              } else {
                return res.text().then(text => { throw new Error(text); });
              }
            })
            .catch(err => {
              console.error("ã‚¨ãƒ©ãƒ¼:", err.message);
              alert("æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            });
  });
</script>

</body>
</html>
