<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ShoseShop ãƒ›ãƒ¼ãƒ </title>
</head>
<body>

<header>
    <div id="logo" style="cursor:pointer;" onclick="location.href='/'">ğŸ‘Ÿ ShoseShop</div>
    <nav>
        <ul id="menu">
            <!-- JSã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«å¿œã˜ã¦å‹•çš„ã«ç”Ÿæˆ -->
        </ul>
    </nav>
</header>

<aside>
    <ul>
        <li><a href="/items">å…¨ã¦ã®å•†å“</a></li>
        <li><a href="/items?brand=Nike">Nike</a></li>
        <li><a href="/items?brand=Adidas">Adidas</a></li>
        <li><a href="/items?brand=Athleta">Athleta</a></li>
    </ul>
</aside>

<main>
    <section>
        <h2>ğŸ†• æ–°å•†å“</h2>
        <div id="newItems" style="display: flex; gap: 20px;"></div>
    </section>

    <section>
        <h2>ğŸ† äººæ°—å•†å“</h2>
        <div id="bestItems" style="display: flex; gap: 20px;"></div>
    </section>
</main>

<script>
    const token = localStorage.getItem("accessToken");
    const menu = document.getElementById("menu");

    // âœ… ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã«ã‚ˆã£ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºã‚’å¤‰æ›´
    if (token) {
        menu.innerHTML = `
            <li><a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
            <li><a href="/mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</a></li>
            <li><a href="/board">æ²ç¤ºæ¿</a></li>
        `;
    } else {
        menu.innerHTML = `
            <li><a href="/login">ãƒ­ã‚°ã‚¤ãƒ³</a></li>
            <li><a href="/register">ä¼šå“¡ç™»éŒ²</a></li>
            <li><a href="/board">æ²ç¤ºæ¿</a></li>
        `;
    }

    function logout() {
        localStorage.removeItem("accessToken");
        window.location.href = "/login";
    }

    // âœ… å•†å“ãƒªã‚¹ãƒˆã‚’å–å¾—
    fetch("/api/home", {
        headers: token ? { "Authorization": "Bearer " + token } : {}
    })
        .then(res => res.json())
        .then(data => {
            const newContainer = document.getElementById("newItems");
            data.newItems.forEach(item => {
                const imageUrl = item.imageUrl.startsWith("/images/")
                    ? item.imageUrl
                    : "/images/" + item.imageUrl;

                newContainer.innerHTML += `
                    <a href="/items/${item.id}" style="text-decoration: none; color: black;">
                        <div>
                            <img src="${imageUrl}" width="120"><br>
                            <strong>${item.name}</strong><br>
                            <span>ï¿¥${item.price}</span>
                        </div>
                    </a>`;
            });

            const bestContainer = document.getElementById("bestItems");
            data.bestItems.forEach(item => {
                const imageUrl = item.imageUrl.startsWith("/images/")
                    ? item.imageUrl
                    : "/images/" + item.imageUrl;

                bestContainer.innerHTML += `
                    <a href="/items/${item.id}" style="text-decoration: none; color: black;">
                        <div>
                            <img src="${imageUrl}" width="120"><br>
                            <strong>${item.name}</strong><br>
                            <span>ï¿¥${item.price}</span>
                        </div>
                    </a>`;
            });
        })
        .catch(err => {
            console.error("å•†å“å–å¾—å¤±æ•—:", err);
        });
</script>

</body>
</html>